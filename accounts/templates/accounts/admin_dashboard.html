{% extends 'base.html' %}

{% block content %}
<div class="container py-5">

    <!-- Statistics Overview Block -->
    <div class="p-4 mb-5" style="background: linear-gradient(135deg, #84fab0, #8fd3f4); border-radius:20px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
        <h2 class="text-center mb-4" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-weight:600; color:#333; text-shadow:1px 1px 2px rgba(0,0,0,0.2);">
            Statistics Overview
        </h2>
        <div class="row g-4 justify-content-center">
            <!-- Accounts Box -->
            <div class="col-6 col-md-3">
                <div class="card border-0 shadow-sm h-100" style="border-radius: 20px; background: linear-gradient(135deg, #8EC5FC, #E0C3FC); transition: transform 0.2s ease;">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center text-center text-dark" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                        <i class="bi bi-people-fill mb-3" style="font-size: 2rem;"></i>
                        <h3 class="mb-1" style="font-size: 1.15rem; font-weight: 600;">Accounts</h3>
                        <p class="mb-3" style="font-size: 0.85rem; font-weight: 500;">Total: {{ total_users }}</p>
                        <a href="{% url 'users_overview' %}" class="text-dark fw-bold" style="font-size: 0.85rem; text-decoration: none;">
                            More Info <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Owners Box -->
            <div class="col-6 col-md-3">
                <div class="card border-0 shadow-sm h-100" style="border-radius: 20px; background: linear-gradient(135deg, #a1c4fd, #c2e9fb); transition: transform 0.2s ease;">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center text-center text-dark">
                        <i class="bi bi-person-badge mb-3" style="font-size: 2rem;"></i>
                        <h3 class="mb-1" style="font-size: 1.15rem; font-weight: 600;">Owners</h3>
                        <p class="mb-3" style="font-size: 0.85rem; font-weight: 500;">Total: {{ total_owners }}</p>
                        <a href="{% url 'admin_owner_list' %}" class="text-dark fw-bold" style="font-size: 0.85rem; text-decoration: none;">
                            More Info <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Clients Box -->
            <div class="col-6 col-md-3">
                <div class="card border-0 shadow-sm h-100" style="border-radius: 20px; background: linear-gradient(135deg, #ffd194, #70e1f5); transition: transform 0.2s ease;">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center text-center text-dark">
                        <i class="bi bi-house mb-3" style="font-size: 2rem;"></i>
                        <h3 class="mb-1" style="font-size: 1.15rem; font-weight: 600;">Clients</h3>
                        <p class="mb-3" style="font-size: 0.85rem; font-weight: 500;">Total: {{ total_clients }}</p>
                        <a href="{% url 'admin_client_list' %}" class="text-dark fw-bold" style="font-size: 0.85rem; text-decoration: none;">
                            More Info <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Agents Box -->
            <div class="col-6 col-md-3">
                <div class="card border-0 shadow-sm h-100" style="border-radius: 20px; background: linear-gradient(135deg, #f093fb, #f5576c); transition: transform 0.2s ease;">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center text-center text-dark">
                        <i class="bi bi-cash-stack mb-3" style="font-size: 2rem;"></i>
                        <h3 class="mb-1" style="font-size: 1.15rem; font-weight: 600;">Agents</h3>
                        <p class="mb-3" style="font-size: 0.85rem; font-weight: 500;">Total: {{ total_agents }}</p>
                        <a href="{% url 'admin_agent_list' %}" class="text-dark fw-bold" style="font-size: 0.85rem; text-decoration: none;">
                            More Info <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Graphs Overview Block -->
    <div class="p-4" style="background: #f0f0f0; border-radius:20px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
        <h2 class="text-center mb-5" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-weight:600; color:#333; text-shadow:1px 1px 2px rgba(0,0,0,0.1);">
            Graphs Overview
        </h2>

        <!-- Row 1 of Graphs -->
        <h3 class="text-center mb-4" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight:500; color:#333;">
            User Growth & System Statistics
        </h3>
        <div class="row g-4 align-items-stretch">
            <!-- Growth Chart -->
            <div class="col-12 col-lg-6 d-flex">
                <div class="card border-0 shadow-sm w-100 h-100" style="border-radius: 20px; background: linear-gradient(135deg, #d4fc79, #96e6a1);">
                    <div class="card-body text-center d-flex flex-column justify-content-center" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                        <h4 class="mb-3" style="font-size:1.1rem; font-weight:600; color:#333;">User Growth Over Time</h4>
                        <div style="width:80%; margin:0 auto;">
                            <img src="data:image/png;base64,{{ growth_chart }}" alt="User Growth Chart" style="width:100%; height:auto; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);"/>
                        </div>
                        <div class="mt-3" style="font-size:0.9rem; color:#333;">
                            <p>{{ growth_advice }}</p>
                        </div>
                        {% if growth_chart %}
                            <div class="mt-3" style="font-size:0.85rem;">
                                <a href="data:image/png;base64,{{ growth_chart }}" target="_blank" class="me-2" style="text-decoration:none; color:#333;">
                                    <i class="bi bi-eye"></i>
                                </a> | 
                                <a href="data:image/png;base64,{{ growth_chart }}" download="growth_chart.png" style="text-decoration:none; color:#333; margin-left: 0.5rem;">
                                    <i class="bi bi-download"></i>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Statistics Bar Chart -->
            <div class="col-12 col-lg-6 d-flex">
                <div class="card border-0 shadow-sm w-100 h-100" style="border-radius: 20px; background: linear-gradient(135deg, #fbc2eb, #a18cd1);">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h4 class="mb-3" style="font-size:1.1rem; font-weight:600; color:#333;">System Statistics</h4>
                        <div style="width:80%; margin:0 auto;">
                            <img src="data:image/png;base64,{{ statistics_chart }}" alt="Statistics Bar Chart" style="width:100%; height:auto; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);"/>
                        </div>
                        <div class="mt-3" style="font-size:0.9rem; color:#333;">
                            <p><strong>Owners:</strong> {{ totals_info.owners }}<br>
                               <strong>Agents:</strong> {{ totals_info.agents }}<br>
                               <strong>Clients:</strong> {{ totals_info.clients }}<br>
                               <strong>Houses:</strong> {{ totals_info.houses }}<br>
                               <strong>Rooms:</strong> {{ totals_info.rooms }}<br>
                               <strong>Overall Total:</strong> {{ totals_info.overall }}</p>
                        </div>
                        {% if statistics_chart %}
                            <div class="mt-3" style="font-size:0.85rem;">
                                <a href="data:image/png;base64,{{ statistics_chart }}" target="_blank" class="me-2" style="text-decoration:none; color:#333;">
                                    <i class="bi bi-eye"></i>
                                </a> | 
                                <a href="data:image/png;base64,{{ statistics_chart }}" download="statistics_chart.png" style="text-decoration:none; color:#333; margin-left: 0.5rem;">
                                    <i class="bi bi-download"></i>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2 of Graphs -->
        <h3 class="text-center mt-5 mb-4" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight:500; color:#333;">
            Houses & Rooms Distribution
        </h3>
        <div class="row g-4 align-items-stretch">
            <!-- Houses by Region -->
            <div class="col-12 col-lg-6 d-flex">
                <div class="card border-0 shadow-sm w-100 h-100" style="border-radius:20px; background: linear-gradient(135deg, #ffecd2, #fcb69f);">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h4 class="mb-3" style="font-size:1.1rem; font-weight:600; color:#333;">Houses by Region</h4>
                        <div style="width:80%; margin:0 auto;">
                            {% if houses_region_chart %}
                                <img src="data:image/png;base64,{{ houses_region_chart }}" alt="Houses by Region Bar Chart" style="width:100%; height:auto; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);" />
                            {% else %}
                                <p style="color:#333; font-size:0.9rem;">No houses found.</p>
                            {% endif %}
                        </div>
                        <div class="mt-3" style="font-size:0.9rem; color:#333;">
                            <p><strong>Total Houses:</strong> {{ total_houses }}</p>
                            <p>{{ region_advice }}</p>
                        </div>
                        {% if houses_region_chart %}
                            <div class="mt-3" style="font-size:0.85rem;">
                                <a href="data:image/png;base64,{{ houses_region_chart }}" target="_blank" class="me-2" style="text-decoration:none; color:#333;">
                                    <i class="bi bi-eye"></i>
                                </a> | 
                                <a href="data:image/png;base64,{{ houses_region_chart }}" download="houses_region_chart.png" style="text-decoration:none; color:#333; margin-left: 0.5rem;">
                                    <i class="bi bi-download"></i>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Rooms Distribution by Region Pie Chart -->
            <div class="col-12 col-lg-6 d-flex">
                <div class="card border-0 shadow-sm w-100 h-100" style="border-radius:20px; background: linear-gradient(135deg, #a1c4fd, #c2e9fb);">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h4 class="mb-3" style="font-size:1.1rem; font-weight:600; color:#333;">Rooms Distribution by Region</h4>
                        <div style="width:80%; margin:0 auto;">
                            {% if rooms_pie_chart %}
                                <img src="data:image/png;base64,{{ rooms_pie_chart }}" alt="Rooms Distribution Pie Chart" style="width:100%; height:auto; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);" />
                            {% else %}
                                <p style="color:#333; font-size:0.9rem;">No rooms data found.</p>
                            {% endif %}
                        </div>
                        <div class="mt-3" style="font-size:0.9rem; color:#333;">
                            <p><strong>Total Rooms:</strong> {{ rooms_pie_total }}</p>
                            <p>{{ rooms_pie_advice }}</p>
                        </div>
                        {% if rooms_pie_chart %}
                            <div class="mt-3" style="font-size:0.85rem;">
                                <a href="data:image/png;base64,{{ rooms_pie_chart }}" target="_blank" class="me-2" style="text-decoration:none; color:#333;">
                                    <i class="bi bi-eye"></i>
                                </a> | 
                                <a href="data:image/png;base64,{{ rooms_pie_chart }}" download="rooms_distribution_chart.png" style="text-decoration:none; color:#333; margin-left: 0.5rem;">
                                    <i class="bi bi-download"></i>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    body {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        margin: 0;
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    .card:hover {
        transform: translateY(-3px);
    }

    @media (max-width: 768px) {
        h1 {
            font-size: 1.5rem;
        }
        h2, h3, h4 {
            font-size: 1rem !important;
        }
        .card-body p, .card-body a {
            font-size: 0.8rem !important;
        }
    }
</style>
{% endblock %}
